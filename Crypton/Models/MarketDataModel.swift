//
//  MarketDataModel.swift
//  Crypton
//
//  Created by Daniil Antsyferov on 23/9/25.
//

import Foundation

// https://api.coingecko.com/api/v3/global

/*
 {
   "data": {
     "active_cryptocurrencies": 18866,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1383,
     "total_market_cap": {
       "btc": 35366214.218481176,
       "eth": 954226989.115123,
       "ltc": 37572838425.922134,
       "bch": 7135400215.598065,
       "bnb": 3968692612.81261,
       "eos": 9347080547795.629,
       "xrp": 1395545671722.2002,
       "xlm": 10809860590721.842,
       "link": 183123763838.71317,
       "dot": 993988519626.0447,
       "yfi": 777597181.3536077,
       "sol": 18249711738.351925,
       "usd": 3997301962821.8237,
       "aed": 14680091458463.15,
       "ars": 5416367743705153,
       "aud": 6051831228371.022,
       "bdt": 486637440971625.8,
       "bhd": 1507142732062.3406,
       "bmd": 3997301962821.8237,
       "brl": 21274040776334.03,
       "cad": 5525710341326.377,
       "chf": 3166830501629.8877,
       "clp": 3814305478963841.5,
       "cny": 28426013448214.844,
       "czk": 82111473664944.17,
       "dkk": 25285433228574.805,
       "eur": 3387657451264.0166,
       "gbp": 2957168016377.9204,
       "gel": 10792715299618.928,
       "hkd": 31081197293207.465,
       "huf": 1319537938650008.8,
       "idr": 66569825570680430,
       "ils": 13341734801780.963,
       "inr": 354955845382434.56,
       "jpy": 590308655295607.2,
       "krw": 5576639757774988,
       "kwd": 1220328321625.9492,
       "lkr": 1208966226637444,
       "mmk": 8392335470944419,
       "mxn": 73335868887200.45,
       "myr": 16782672290907.432,
       "ngn": 5955060545153069,
       "nok": 39526968696790.88,
       "nzd": 6825345133894.709,
       "php": 228665670775128.38,
       "pkr": 1133560574780404,
       "pln": 14420942374911.447,
       "rub": 334544450350791.2,
       "sar": 14992804388316.664,
       "sek": 37307734601165.555,
       "sgd": 5129689641265.693,
       "thb": 127346845391970.25,
       "try": 165491902829892.03,
       "twd": 121030312827621.16,
       "uah": 165431671483916.25,
       "vef": 400249845537.34906,
       "vnd": 105595087373846220,
       "zar": 68988527188796.3,
       "xdr": 2768639266603.392,
       "xag": 90040026172.95413,
       "xau": 1056406962.7345514,
       "bits": 35366214218481.17,
       "sats": 3536621421848117.5
     },
     "total_volume": {
       "btc": 1510679.3257635362,
       "eth": 40760115.731824875,
       "ltc": 1604935995.4007525,
       "bch": 304790937.4795276,
       "bnb": 169523993.81649047,
       "eos": 399263581127.7336,
       "xrp": 59611186580.6612,
       "xlm": 461746705709.19836,
       "link": 7822191043.071411,
       "dot": 42458542420.429184,
       "yfi": 33215316.131547835,
       "sol": 779542363.623006,
       "usd": 170746051493.21707,
       "aed": 627064874108.8397,
       "ars": 231361907175012.97,
       "aud": 258505936293.64932,
       "bdt": 20786876329956.242,
       "bhd": 64378091255.00256,
       "bmd": 170746051493.21707,
       "brl": 908727560652.0508,
       "cad": 236032511742.16357,
       "chf": 135272193327.0893,
       "clp": 162929297255857.62,
       "cny": 1214226395983.7148,
       "czk": 3507418263863.453,
       "dkk": 1080075491976.7814,
       "eur": 144704888195.78058,
       "gbp": 126316392180.21858,
       "gel": 461014339031.6862,
       "hkd": 1327643436211.7754,
       "huf": 56364491578448.89,
       "idr": 2843551718259953,
       "ils": 569896534878.1384,
       "inr": 15162054209860.822,
       "jpy": 25215225917744.414,
       "krw": 238207978305443.97,
       "kwd": 52126720568.26126,
       "lkr": 51641384990908.83,
       "mmk": 358481335110009.25,
       "mxn": 3132565455844.171,
       "myr": 716877297194.272,
       "ngn": 254372345133050,
       "nok": 1688407304538.1458,
       "nzd": 291546833972.0502,
       "php": 9767528387907.639,
       "pkr": 48420408083331.72,
       "pln": 615995236844.4829,
       "rub": 14290174842343.37,
       "sar": 640422508463.2057,
       "sek": 1593611999431.9863,
       "sgd": 219116358928.6276,
       "thb": 5439661857681.209,
       "try": 7069040374011.583,
       "twd": 5169849117857.678,
       "uah": 7066467572507.684,
       "vef": 17096802136.015818,
       "vnd": 4510528449904141,
       "zar": 2946867343367.7446,
       "xdr": 118263325407.5925,
       "xag": 3846088959.0950127,
       "xau": 45124766.488627404,
       "bits": 1510679325763.5361,
       "sats": 151067932576353.62
     },
     "market_cap_percentage": {
       "btc": 56.33930133688959,
       "eth": 12.664918872919023,
       "usdt": 4.329021515691815,
       "xrp": 4.2882486791995005,
       "bnb": 3.508345371277484,
       "sol": 2.978289087391297,
       "usdc": 1.8542385213595598,
       "doge": 0.9091897595614563,
       "steth": 0.8940458276857571,
       "trx": 0.7938123870235044
     },
     "market_cap_change_percentage_24h_usd": 0.10233617600408336,
     "updated_at": 1758636077
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }

    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }

    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }

}

